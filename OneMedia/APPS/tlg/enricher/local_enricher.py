# this script service as enricher of channels, should be run locally
from APPS.tlg.dao_layer import retrieve_all_messages, add_anchor_empty

test1 = """**–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —ç–∫–æ–Ω–æ–º–∏–∫–∏ –ü–µ–Ω–∑–µ–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –∑–∞–ø—É—Å—Ç–∏–ª–æ —Å–≤–æ–π telegram-–∫–∞–Ω–∞–ª - @minecp_12enzaa. **–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â–∞—Ç—å—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞, –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –Ω–∞–ª–æ–≥–æ–≤–æ–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–º —Ä–∞–∑–≤–∏—Ç–∏–∏ —Ä–µ–≥–∏–æ–Ω–∞.

#–ø–µ–Ω–∑–µ–Ω—Å–∫–∞—è–æ–±–ª–∞—Å—Ç—å
#—ç–∫–æ–Ω–æ–º–∏–∫–∞

@penzregru"""

test2 = """**–í –ñ—É–∫–æ–≤—Å–∫–æ–º –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —é–±–∏–ª–µ–π–Ω—ã–π –∞–≤–∏–∞—Å–∞–ª–æ–Ω –ú–ê–ö–°-2021

**–Æ–±–∏–ª–µ–π–Ω—ã–π 15-–π –∞–≤–∏–∞—Å–∞–ª–æ–Ω –ú–ê–ö–° –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å–µ–≥–æ–¥–Ω—è –≤–æ –≤—Ç–æ—Ä–Ω–∏–∫, 20 –∏—é–ª—è –≤ 12-00, –≤ –ø–æ–¥–º–æ—Å–∫–æ–≤–Ω–æ–º –ñ—É–∫–æ–≤—Å–∫–æ–º, –≤—ã—Å—Ç–∞–≤–∫—É –æ—Ç–∫—Ä–æ–µ—Ç –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç –†–æ—Å—Å–∏–∏ –í–ª–∞–¥–∏–º–∏—Ä –ü—É—Ç–∏–Ω.

–û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –≥–ª–∞–≤–∞ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞ –æ—Å–º–æ—Ç—Ä–∏—Ç –ø–µ—Ä–µ–¥–æ–≤—ã–µ –æ–±—Ä–∞–∑—Ü—ã –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–≤–∏–∞—Ç–µ—Ö–Ω–∏–∫–∏. –ó–∞—Ç–µ–º –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç –ø—Ä–æ–≤–µ–¥–µ—Ç —Å–æ–≤–µ—â–∞–Ω–∏–µ –ø–æ –≤–æ–ø—Ä–æ—Å—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —Å—Ñ–µ—Ä–µ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –∞–≤–∏–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.

–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –æ —Ä–∞–±–æ—Ç–µ –≤—ã—Å—Ç–∞–≤–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∞—ç—Ä–æ–∫–æ—Å–º–∏—á–µ—Å–∫–∞—è –æ—Ç—Ä–∞—Å–ª—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ—é –ø—Ä–æ–¥—É–∫—Ü–∏—é, –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º Telegram-–∫–∞–Ω–∞–ª–µ –∞–≤–∏–∞—Å–∞–ª–æ–Ω–∞: https://t.me/aviasalonmaks
"""

test21 = """
**–ó–∞–ø–∏—Å—å –í–æ–ª–æ–¥–∏–Ω–∞ –≤ Telegram –æ QR-–∫–æ–¥–∞—Ö –Ω–∞–±—Ä–∞–ª–∞ 1 –º–ª–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

**–ü–æ—Å—Ç —Å–ø–∏–∫–µ—Ä–∞ –ì–æ—Å–¥—É–º—ã –í—è—á–µ—Å–ª–∞–≤–∞ –í–æ–ª–æ–¥–∏–Ω–∞ –≤ –µ–≥–æ Telegram-–∫–∞–Ω–∞–ª–µ –æ –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç–∞—Ö –ø—Ä–æ QR-–∫–æ–¥—ã [–Ω–∞–±—Ä–∞–ª](https://rg.ru/2021/12/06/zapis-volodina-v-telegram-o-qr-kodah-nabrala-1-mln-prosmotrov.html) –º–∏–ª–ª–∏–æ–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤.

–í [—Å–æ–æ–±—â–µ–Ω–∏–∏](https://t.me/vv_volodin/220), –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–º 24 –Ω–æ—è–±—Ä—è, –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –ì–î —Ä–∞—Å—Å–∫–∞–∑–∞–ª –æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç–æ–≤ –æ QR-–∫–æ–¥–∞—Ö –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∏ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ. –û–Ω, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –∫ –¥–µ–ø—É—Ç–∞—Ç–∞–º –ø–æ—Å—Ç—É–ø–∏–ª–æ –±–æ–ª–µ–µ 120 —Ç—ã—Å—è—á –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ –¥–∞–Ω–Ω–æ–º—É –ø–æ–≤–æ–¥—É, –µ—â–µ –±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –í–æ–ª–æ–¥–∏–Ω –æ—Ç–∫—Ä—ã–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –ø–æ—Å—Ç–æ–º, –º–µ–Ω–µ–µ —á–µ–º –∑–∞ —Å—É—Ç–∫–∏ –æ–Ω –Ω–∞–±—Ä–∞–ª –±–æ–ª–µ–µ 307 —Ç—ã—Å. –æ—Ç–∫–ª–∏–∫–æ–≤. –ê –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Å—Ç–∞–≤–∏–ª–∏ —Ç–∞–º –±–æ–ª–µ–µ 700 —Ç—ã—Å—è—á –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ì—Ä–∞–∂–¥–∞–Ω–µ —Å–ø–æ—Ä–∏–ª–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–∞–±–º–∏–Ω–æ–º –ø–æ–ø—Ä–∞–≤–∫–∏ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏, –¥–∞ –∏ —Ç–∞–∫ –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è. –°—Ç–æ—Ä–æ–Ω–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞–ø–æ–º–∏–Ω–∞—é—Ç, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ —Ä–æ—Å—Å–∏—è–Ω –≤–∞–∫—Ü–∏–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞.

–ö–æ–º–º–µ–Ω—Ç–∏—Ä—É—è —Ä–∞–Ω–µ–µ –±—É—Ä–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram-–∫–∞–Ω–∞–ª–µ, –í—è—á–µ—Å–ª–∞–≤ –í–æ–ª–æ–¥–∏–Ω –ø–æ–¥—á–µ—Ä–∫–Ω—É–ª, —á—Ç–æ –¥–µ–ø—É—Ç–∞—Ç—ã –ì–æ—Å–¥—É–º—ã —Ö–æ—Ç—è—Ç —É—Å–ª—ã—à–∞—Ç—å –º–Ω–µ–Ω–∏—è –≥—Ä–∞–∂–¥–∞–Ω –†–§. "–ï—Å–ª–∏ —É–≤–∏–¥–∏–º, —á—Ç–æ –∏–¥–µ–∏ –∏ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –ø—Ä–∏–Ω—è—Ç—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –∑–∞–∫–æ–Ω–∞, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –µ–≥–æ —É–ª—É—á—à–∞—Ç, –∫–æ–Ω–µ—á–Ω–æ, –±—É–¥–µ–º –æ–±—Å—É–∂–¥–∞—Ç—å —Å –≤–∞–º–∏. –í –∏—Ç–æ–≥–µ –∑–∞–∫–æ–Ω, –Ω–∞–¥–µ—é—Å—å, —Å—Ç–∞–Ω–µ—Ç –ª—É—á—à–µ, –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –±—É–¥–µ—Ç —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ª—é–¥–µ–π", - –¥–æ–±–∞–≤–∏–ª –ø–æ–ª–∏—Ç–∏–∫."""

test3 = """
**üè¢ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ Telegram-–∫–∞–Ω–∞–ª—ã –≥–æ—Å–∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–π –∏ –≥–æ—Å–∫–æ–º–ø–∞–Ω–∏–π –†–§

**@gazprom –ì–∞–∑–ø—Ä–æ–º
@news_mrg –ì–∞–∑–ø—Ä–æ–º –º–µ–∂—Ä–µ–≥–∏–æ–Ω–≥–∞–∑
@paogazprom_neft –ì–∞–∑–ø—Ä–æ–º –Ω–µ—Ñ—Ç—å
@transneftofficial –¢—Ä–∞–Ω—Å–Ω–µ—Ñ—Ç—å
@rosseti_official –†–æ—Å—Å–µ—Ç–∏
@rushydro_official –ì—Ä—É–ø–ø–∞ –†—É—Å–ì–∏–¥—Ä–æ
@sberbank –°–±–µ—Ä–±–∞–Ω–∫
@bankvtb –í–¢–ë
@roscosmos_gk –†–æ—Å–∫–æ—Å–º–æ—Å
@rogozin_do –ì–µ–Ω. –¥–∏—Ä–µ–∫—Ç–æ—Ä –†–æ—Å–∫–æ—Å–º–æ—Å–∞ –î–º–∏—Ç—Ä–∏–π –†–æ–≥–æ–∑–∏–Ω
@domrf_life –î–û–ú.–†–§
@corpmspof –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏—è –ú–°–ü
@oi_press –§–æ–Ω–¥ "–°–∫–æ–ª–∫–æ–≤–æ"
@ERDCnews –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è –î–∞–ª—å–Ω–µ–≥–æ –í–æ—Å—Ç–æ–∫–∞ –∏ –ê—Ä–∫—Ç–∏–∫–∏
@rfrit –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ–Ω–¥ —Ä–∞–∑–≤–∏—Ç–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
@telerzd –†–ñ–î
@avtodorgk –ê–≤—Ç–æ–¥–æ—Ä
@napochte –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏
@rusgeology –ê–û –†–æ—Å–≥–µ–æ–ª–æ–≥–∏—è
@Alrosa_news –ê–õ–†–û–°–ê
@ao_gtlk –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –ª–∏–∑–∏–Ω–≥–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è
@rosgoscirc –†–æ—Å–≥–æ—Å—Ü–∏—Ä–∫
@doc_brown_channel –†–æ—Å—Å–∏–π—Å–∫–∞—è –≤–µ–Ω—á—É—Ä–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è
@uvznews –£—Ä–∞–ª–≤–∞–≥–æ–Ω–∑–∞–≤–æ–¥

‚ÑπÔ∏è @GovInfo** –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –≤ Telegram**"""


def isEnglish(s):
    try:
        s.encode(encoding='utf-8').decode('ascii')
    except UnicodeDecodeError:
        return False
    else:
        return True


def getChannelsFromContent(content):
    channel_names = []
    acc = ""
    flag = False
    for char in content:
        if char == '@':
            flag = True
            continue
        if flag and (char.isalpha() or char == '_' or char.isdigit()):
            acc += char
        elif flag:
            if isEnglish(acc):
                channel_names.append(acc)
            acc = ""
            flag = False
    if flag and len(acc) != 0 and isEnglish(acc):
        channel_names.append(acc)
    return channel_names


def getChannelsFromContentFromUrl(content):
    channel_names = []
    url = "https://t.me/"
    occurrences = [i for i in range(len(content)) if content.startswith(url, i)]
    for index in occurrences:
        start = index + len(url)
        acc = ""
        while start < len(content):
            char = content[start]
            if char.isalpha() or char == '_' or char.isdigit():
                acc += char
            else:
                break
            start += 1
        if len(acc) != 0:
            channel_names.append(acc)
    return channel_names


messages = retrieve_all_messages("1458668252")
count = 0

# print(len(messages))
for message in messages:
    content = message[7]
    listToAdd = getChannelsFromContentFromUrl(content) + getChannelsFromContent(content)
    for channel_name in listToAdd:
        add_anchor_empty(channel_name)
        print("added channel_name: " + channel_name + ", count: " + str(count))
    count += 1
    print("----------------------------------------------")

print("count: " + str(count))
